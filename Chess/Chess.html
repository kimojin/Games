<!DOCTYPE = html>
<html lang = "en">

<head>
	<meta charset = "UTF-8">
	<link rel = "stylesheet" href = "style.css">
	<link rel = "icon" href = "favicon.jpeg">
	<script src = "chess.js"></script>
</head>

<body>
	<div class = "board" id = "board"></div>
	
	<script>
		var board = new Object;
		var square = new Object;
		var piece = new Object;
		
		initSquare();
		initPiece();
		
		setBoard();
		setPiece();
		
		function setBoard(){
			let cont = "";
			let color = ["dark", "light"];
			
			for(let r = 7; r >= 0; r--){
				for(let f = 0; f < 8; f++){
					cont += `<div class = "${color[(r + f) % 2]} square" id = "${file(f)}${rank(r)}">`;
					cont += "</div>";
				}
			}
			
			document.getElementById("board").innerHTML = cont;
			
			return 0;
		}
		
		function setPiece(){
			sync();
			
			for(i = 0; i < 64; i++){
				document.getElementById(`${square[i].name}`).innerHTML = "";
				
				if(square[i].piece){
					document.getElementById(`${square[i].name}`).innerHTML = `<div class = "piece" id = "${piece[square[i].piece].name}" onmouseenter = "this.classList.add('focus')" onmouseout = "this.classList.remove('focus')" onclick = "if(!this.classList.contains('click')){this.classList.add('click')}else{this.classList.remove('click')}; guide(${square[i].piece});">${piece[square[i].piece].code}`;
					document.getElementById(`${square[i].name}`).innerHTML += "</div>";
				}
			}
		}
		
		function initSquare(){
			for(let r = 0; r < 8; r++){
				for(let f = 0; f < 8; f++){
					square[sq(r, f)] = {
						name: `${file(f)}${rank(r)}`,
						rank: r,
						file: f,
						piece: 0
					}
				}
			}
			
			return 0;
		}
		
		function initPiece(){
			let name = ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R', 'r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'];
			let code = [2, 4, 3, 1, 0, 3, 4, 2];
			
			piece[0] = {
				name: "",
				name: "",
				code: ""
			}
			
			for(i = 0; i < 8; i++){
				piece[i + 1] = {
					name: `${name[i]}`,
					code: `&#${9812 + code[i]}`,
					color: "white",
					file: i,
					rank: 0
				}
				
				piece[i + 9] = {
					name: `${name[i]}`,
					code: `&#${9818 + code[i]}`,
					color: "black",
					file: i,
					rank: 7
				}
				
				piece[i + 17] = {
					name: "P",
					code: "&#9817",
					color: "white",
					file: i,
					rank: 1
				}
				
				piece[i + 25] = {
					name: "p",
					code: "&#9823",
					color: "black",
					file: i,
					rank: 6
				}
			}
			
			for(i = 1; i < 33; i++){
				piece[i].square = sq(piece[i].rank, + piece[i].file);
				piece[i].not = `${not(piece[i].rank, piece[i].file)}`;
			}
			
			return 0;
		}
		
		function sync(){
			let r, f;
			
			for(let i = 0; i < 64; i ++){
				square[i].piece = 0;
			}
			
			for(let i = 0; i < 32; i++){
				r = piece[i + 1].rank;
				f = piece[i + 1].file;
				
				if(piece[i + 1].not != "captured")
					square[sq(r, f)].piece = i + 1;
			}
			
			for(let i = 0; i < 32; i++){
				legalMove(i + 1);
			}
			
			return 0;
		}
		
		function legalMove(x){
			var p = piece[x];
			var n = p.name;
			var r = p.rank;
			var f = p.file;
			var move = [];
			
			if(p.not == "captured")
				return 0;
				
			function movePush(rank, file){
				let P = piece[square[sq(rank, file)].piece];
				
				if(P){
					if(p.color != P.color){
						move.push(not(rank, file));
					}
				} else{
					move.push(not(rank, file));
				}
				
				return 0;
			}
			
			switch(n){
				case "P":
					if(!square[(r + 1) * 8 + f].piece){
						movePush(r + 1, f);
						
						if(r == 1){
							if(!square[(r + 2) * 8 + f].piece){
								movePush(r + 2, f);
							}
						}
					}
					
					if(f == 0){
						if(square[(r + 1) * 8 + f + 1].piece){
							movePush(r + 1, f + 1);
						}
					} else if(f == 7){
						if(square[(r + 1) * 8 + f - 1].piece){
							movePush(r + 1, f - 1);
						}
					} else{
						if(square[(r + 1) * 8 + f - 1].piece){
							movePush(r + 1, f - 1);
						}
						if(square[(r + 1) * 8 + f + 1].piece){
							movePush(r + 1, f + 1);
						}
					}
					
					
					piece[x].legalMove = move;
					
					break;
				
				case "p":
					if(!square[sq((r - 1), f)].piece){
						movePush(r - 1, f);
						
						if(r == 6){
							if(!square[(r - 2) * 8 + f].piece){
								movePush(r - 2, f);
							}
						}
					}
					
					if(f == 0){
						if(square[(r - 1) * 8 + f + 1].piece){
							movePush(r - 1, f + 1);
						}
					} else if(f == 7){
						if(square[(r - 1) * 8 + f - 1].piece){
							movePush(r - 1, f - 1);
						}
					} else{
						if(square[(r - 1) * 8 + f - 1].piece){
							movePush(r - 1, f - 1);
						}
						if(square[(r - 1) * 8 + f + 1].piece){
							movePush(r - 1, f + 1);
						}
					}
					
					piece[x].legalMove = move;
					
					break;
					
				case "R":
					for(let i = r + 1; i <= 7; i++){
						movePush(i, f);
						
						if(square[i * 8 + f].piece)
							break;
					}
					
					for(let i = r - 1; i >= 0; i--){
						movePush(i, f);
						
						if(square[i * 8 + f].piece)
							break;
					}
					
					for(let i = f + 1; i <= 7; i++){
						movePush(r, i);
						
						if(square[r * 8 + i].piece)
							break;
					}
					
					for(let i = f - 1; i >= 0; i--){
						movePush(r, i);
						
						if(square[r * 8 + i].piece)
							break;
					}
					
					piece[x].legalMove = move;
					
					break;
					
				case "r":
					for(let i = r + 1; i <= 7; i++){
						movePush(i, f);
						
						if(square[i * 8 + f].piece)
							break;
					}
					
					for(let i = r - 1; i >= 0; i--){
						movePush(i, f);
						
						if(square[i * 8 + f].piece)
							break;
					}
					
					for(let i = f + 1; i <= 7; i++){
						movePush(r, i);
						
						if(square[r * 8 + i].piece)
							break;
					}
					
					for(let i = f - 1; i >= 0; i--){
						movePush(r, i);
						
						if(square[r * 8 + i].piece)
							break;
					}
					
					piece[x].legalMove = move;
					
					break;
				
				case "N":
					break;
					
				case "B":
					for(let i = 1; i <= 7; i++){
						if((r + i == 8) || (f + i == 8))
							break;
							
						movePush(r + i, f + i);
						
						if(square[(r + i) * 8 + f + 1].piece)
							break;
					}
					
					for(let i = 1; i <= 7; i++){
						if((r + i == 8) || (f - i == -1))
							break;
							
						movePush(r + i, f - i);
						
						if(square[(r + i) * 8 + f - 1].piece)
							break;
					}
					
					for(let i = 1; i <= 7; i++){
						if((r - i == -1) || (f + i == 8))
							break;
							
						movePush(r - i, f + i);
						
						if(square[(r - i) * 8 + f + 1].piece)
							break;
					}
					
					for(let i = 1; i <= 7; i++){
						if((r - i == -1) || (f - i == -1))
							break;
							
						movePush(r - i, f - i);
						
						if(square[(r - i) * 8 + f - 1].piece)
							break;
					}
					
					piece[x].legalMove = move;
					
					break;
					
				case "b":
					for(let i = 1; i <= 7; i++){
						if((r + i == 8) || (f + i == 8))
							break;
							
						movePush(r + i, f + i);
						
						if(square[(r + i) * 8 + f + 1].piece)
							break;
					}
					
					for(let i = 1; i <= 7; i++){
						if((r + i == 8) || (f - i == -1))
							break;
							
						movePush(r + i, f - i);
						
						if(square[(r + i) * 8 + f - 1].piece)
							break;
					}
					
					for(let i = 1; i <= 7; i++){
						if((r - i == -1) || (f + i == 8))
							break;
							
						movePush(r - i, f + i);
						
						if(square[(r - i) * 8 + f + 1].piece)
							break;
					}
					
					for(let i = 1; i <= 7; i++){
						if((r - i == -1) || (f - i == -1))
							break;
							
						movePush(r - i, f - i);
						
						if(square[(r - i) * 8 + f - 1].piece)
							break;
					}
					
					piece[x].legalMove = move;
					
					break;
			}
			
			return 0;
		}
		
		function guide(x){
			legalMove(x);
			
			let sq;
			
			for(let i = 0; i < piece[x].legalMove.length; i++){
				sq = document.getElementById(`${piece[x].legalMove[i]}`);
				
				if(sq.classList.contains("guide")){
					sq.classList.remove("guide");
				} else{
					sq.classList.add("guide");
				}
			}
			
			return 0;
		}
		
		function move(from, to){
			if(typeof(from) == "string"){
				for(let i = 0; i < 64; i++){
					if(square[i].name == from){
						from = i;
						break;
					}
				}
			}
			
			if(typeof(to) == "string"){
				for(let i = 0; i < 64; i++){
					if(square[i].name == to){
						to = i;
						break;
					}
				}
			}
			
			if(!square[from].piece)
				return 1;
			
			let p = piece[square[from].piece];
			
			if(square[to].piece){
				let P = piece[square[to].piece];
				
				P.rank = 8;
				P.file = 8;
				P.not = "captured";
			}
			
			square[to].piece = square[from].piece;
			p.rank = square[to].rank;
			p.file = square[to].file;
			p.not = square[to].name;
			square[from].piece = 0;
			
			setPiece();
			
			return 0;
		}
	</script>
</body>

</html>