<!DOCTYPE = html>
<html lang = "en">

<head>
	<meta charset = "UTF-8">
	<link rel = "stylesheet" href = "style.css">
	<link rel = "icon" href = "favicon.jpeg">
	<script src = "chess.js"></script>
</head>

<body>
	<div class = "board" id = "board"></div>
	
	<script>
		var board = new Object;
		var square = new Object;
		var piece = new Object;
		var turn = "white";
		
		initSquare();
		initPiece();
		
		setBoard();
		setPiece();
		
		function setBoard(){
			let cont = "";
			let color = ["dark", "light"];
			
			for(let r = 8; r > 0; r--){
				for(let f = 1; f < 9; f++){
					cont += `<div class = "${color[(r + f) % 2]} square" id = "${not(r, f)}">`;
					cont += "</div>";
				}
			}
			
			document.getElementById("board").innerHTML = cont;
			
			return 0;
		}
		
		function setPiece(){
			sync();
			
			for(i = 0; i < 64; i++){
				let s = square[i + 1];
				let p = getPieceByCoord(i + 1);
				
				document.getElementById(`${s.name}`).innerHTML = "";
				
				if(s.piece){
					if(turn == p.color){
						document.getElementById(`${s.name}`).innerHTML += `<div class = "piece" id = "${p.name}" onmouseover = "mouseOverPiece(${s.piece})" onmouseout = "mouseOutPiece(${s.piece})" onclick = "clickPiece(${s.piece})">${p.code}`;
					} else{
						document.getElementById(`${s.name}`).innerHTML += `<div class = "piece" id = "${p.name}">${p.code}`;
					}
					
					document.getElementById(`${s.name}`).innerHTML += "</div>";
				}
			}
		}
		
		function initSquare(){
			square[0] = {
				name: "x0",
				color: "none",
				coord: 0,
				rank: 0,
				file: 0,
				piece: 0
			}
			
			for(let r = 1; r < 9; r++){
				for(let f = 1; f < 9; f++){
					square[coord(r, f)] = {
						name: `${not(r, f)}`,
						coord: coord(r, f),
						rank: r,
						file: f,
						piece: 0
					}
				}
			}
			
			return 0;
		}
		
		function initPiece(){
			let name = ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R', 'r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'];
			let code = [2, 4, 3, 1, 0, 3, 4, 2];
			
			piece[0] = {
				name: "X1",
				code: "none",
				role: "none",
				color: "none",
				rank: 0,
				file: 0,
			}
			
			for(i = 0; i < 8; i++){
				piece[i + 1] = {
					name: `${name[i]}${0}${Math.floor(i / 5 + 1)}`,
					code: `&#${9812 + code[i]}`,
					color: "white",
					file: i + 1,
					rank: 1
				}
				
				piece[i + 9] = {
					name: `P0${i + 1}`,
					code: "&#9817",
					color: "white",
					file: i + 1,
					rank: 2
				}
				
				piece[i + 17] = {
					name: `${name[i + 8]}${0}${Math.floor(i / 5 + 1)}`,
					code: `&#${9818 + code[i]}`,
					color: "black",
					file: i + 1,
					rank: 8
				}
				
				piece[i + 25] = {
					name: `p0${i + 1}`,
					code: "&#9823",
					color: "black",
					file: i + 1,
					rank: 7
				}
			}
			
			for(i = 0; i < 33; i++){
				piece[i].square = coord(piece[i].rank, piece[i].file);
				piece[i].not = `${not(piece[i].rank, piece[i].file)}`;
			}
			
			return 0;
		}
		
		function sync(){
			for(let i = 0; i < 64; i ++){
				square[i + 1].piece = 0;
			}
			
			for(let i = 0; i < 32; i++){
				let r = piece[i + 1].rank;
				let f = piece[i + 1].file;
				
				if(piece[i + 1].not != "x0")
					square[coord(r, f)].piece = i + 1;
			}
			
			return 0;
		}
		
		function mouseOverPiece(index){
			let p = piece[index];
			let s = getSquareByPiece(p);
			
			document.getElementById(s.name).classList.add('focused');
		}
		
		function mouseOutPiece(index){
			let p = piece[index];
			let s = getSquareByPiece(p);
			
			document.getElementById(s.name).classList.remove('focused');
		}
		
		function clickPiece(index){
			let p = piece[index];
			let s = getSquareByPiece(p);
			
			if(!document.getElementById(s.name).classList.contains('clicked')){
				document.getElementById(s.name).classList.add('clicked');
			} else{
				document.getElementById(s.name).classList.remove('clicked');
			}
		}
	</script>
</body>

</html>